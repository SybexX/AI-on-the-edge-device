<!DOCTYPE html>
<html lang="en" xml:lang="en"> 
<head>
<title>Info</title>
<meta charset="UTF-8" />

<style>
h1 {font-size: 2em;}
h2 {font-size: 1.5em;}
h3 {font-size: 1.2em;}
p {font-size: 1em;}

th, td {
  padding: 5px 5px 5px 5px;
  border-width: 1px;
  border-style: solid;
  border-color: rgb(240, 240, 240);
}

output {
	padding-left:5px;
}

table {
    width: 660px;
	padding: 5px;
	border-collapse:collapse;
}
</style>

<script type="text/javascript" src="common.js?v=$COMMIT_HASH"></script> 
</head>

<body style="font-family: arial; padding: 0px 10px;">
	<table>
		<colgroup>
			<col span="1" style="width: 40%;">
			<col span="1" style="width: 60%;">
		</colgroup>
		<tr>
			<h3>Runtime Information</h3>
		</tr>
		<tr>
			<td>Start time:</td>
			<td><output id="starttime"></output></td>
		</tr>
		<tr>
			<td>Uptime:</td>
			<td><output id="uptime"></output></td>
		</tr>
	</table>

	<table>
		<colgroup>
			<col span="1" style="width: 40%;">
			<col span="1" style="width: 60%;">
		</colgroup>
		<tr>
			<h3>Build Info</h3>
		</tr>
		<tr>
			<td>Board Type:</td>
			<td>
				<output id="boardtype"></output>
			</td>
		</tr>
		<tr>
			<td>Firmware version:</td>
			<td>
				<output id="firmware"></output>
			</td>
		</tr>
		<tr>
			<td>Firmware build time:</td>
			<td>
				<output id="build-time"></output>
			</td>
		</tr>

		<tr>
			<td>Web interface version:</td>
			<td>
				<output id="web-ui"></output>
			</td>
		</tr>
	</table>

	<table>
		<colgroup>
			<col span="1" style="width: 40%;">
			<col span="1" style="width: 60%;">
		</colgroup>
		<tr>
			<h3>Device Info</h3>
		</tr>
		<tr>
			<td>Chip Cores:</td>
			<td>
				<output id="chip-cores"></output>
			</td>
		</tr>
		<tr>
			<td>Chip Revision:</td>
			<td>
				<output id="chip-revision"></output>
			</td>
		</tr>
		<tr>
			<td>Chip Features:</td>
			<td>
				<output id="chip-features"></output>
			</td>
		</tr>
	</table>


	<table>
		<colgroup>
			<col span="1" style="width: 40%;">
			<col span="1" style="width: 60%;">
		</colgroup>
		<tr>			
			<h3>Host Info</h3>
		</tr>
		<tr>
			<td>Hostname:</td>
			<td>
				<output id="hostname"></output>
			</td>
		</tr>
		<tr>
			<td>IP Address:</td>	
			<td>
				<output id="IP-address"></output>
			</td>
		</tr>
		<tr>
			<td>WLAN SSID:</td>	
			<td>
				<output id="wlan-ssid"></output>
			</td>
		</tr>
	</table>

	<table>
		<colgroup>
			<col span="1" style="width: 40%;">
			<col span="1" style="width: 60%;">
		</colgroup>
		<tr>			
			<h3>SD Card Info</h3>
		</tr>
		<tr>
			<td>SD card manufacturer:</td>
			<td>
				<output id="SDCardManufacturer"></output>
			</td>
		</tr>
		<tr>
			<td>SD card name:</td>
			<td>
				<output id="SDCardName"></output>
			</td>
		</tr>
		<tr>
			<td>SD card size:</td>
			<td>
				<output id="SDCardCapacity"></output>
			</td>
		</tr>
		<tr>
			<td>SD card sector size:</td>
			<td>
				<output id="SDCardSectorSize"></output>
			</td>
		</tr>
		<tr>
			<td>Partition size:</td>
			<td>
				<output id="SDCardPartitionSize"></output>
			</td>
		</tr>
		<tr>
			<td>Partition free space:</td>	
			<td>
				<output id="SDCardFreePartitionSpace"></output>
			</td>
		</tr>
		<tr>
			<td>Partition allocation size:</td>	
			<td>
				<output id="SDCardPartitionAllocationSize"></output>
			</td>
		</tr>
	</table>

	<table>
		<colgroup>
			<col span="1" style="width: 40%;">
			<col span="1" style="width: 60%;">
		</colgroup>
		<tr>			
			<h3>Memory Info</h3>
		</tr>
		<tr>
			<td>Total Free (Int + Ext):</td>	
			<td>
				<output id="RAMTotalFree"></output>
			</td>
		</tr>
		<tr>
			<td>Ext. RAM - Free:</td>	
			<td>
				<output id="ExtRAMFree"></output>
			</td>
		</tr>
		<tr>
			<td>Ext. RAM - Largest Free Block:</td>	
			<td>
				<output id="ExtRAMLargestFree"></output>
			</td>
		</tr>
		<tr>
			<td>Ext. RAM - Min Free:</td>	
			<td>
				<output id="ExtRAMMinFree"></output>
			</td>
		</tr>
		<tr>
			<td>Int. RAM - Free:</td>	
			<td>
				<output id="IntRAMFree"></output>
			</td>
		</tr>
		<tr>
			<td>Int. RAM - Largest Free Block:</td>	
			<td>
				<output id="IntRAMLargestFree"></output>
			</td>
		</tr>
		<tr>
			<td>Int. RAM - Min Free:</td>	
			<td>
				<output id="IntRAMMinFree"></output>
			</td>
		</tr>
	</table>


<h3>Copyright</h3>
Copyright &copy; 2020 - 2024 by <a href="https://github.com/jomjol/AI-on-the-edge-device" target=_blank>Jomjol</a> and others.

<script type="text/javascript">
		var gateway = `ws://${window.location.hostname}/ws`;
        var ws;
		domainname = getDomainname();
        window.addEventListener('load', onLoad);
        window.addEventListener('beforeunload', onUnload);
		
        function onUnload(event) {		
            ws.close();
        }		
		
        function onLoad(event) {
            initWebSocket();
        }		
		
        function initWebSocket() {
            if(ws == null) {
                console.log('Trying to open a WebSocket connection...');
			
                ws = new WebSocket(gateway);
                ws.onopen = onOpen;
                ws.onclose = onClose;
                ws.onmessage = onMessage;
                ws.error = onError;
            }
            else {
			    ws.close();
            }
        }

        function onOpen(event) {
            console.log('Connection opened');
			ws.send('SystemInfo');
        }

        function onClose(event) {
            console.log('Connection closed');
            ws.onopen = null;
            ws.onclose = null;
            ws.onmessage = null;
            ws = null;
            setTimeout(initWebSocket, 10000);
        }

        function onMessage(event) {
            // console.log(event.data);
			
			var myObj = JSON.parse(event.data);
			var myKeys = Object.keys(myObj);
			var myValues = Object.values(myObj);

			for (var i = 0; i < myKeys.length; i++) {
			    var myKey = myKeys[i];
			    var myValue = myValues[i];
				
			    if(myKey == 'BoardType') {
					document.getElementById("boardtype").value = myValue;
			    }
			    else if(myKey == 'Starttime') {
				    //Input format: 19700101-010019
				    var timestamp = myValue.substr(6,2) + "." +
						myValue.substr(4,2) + "." +
						myValue.substr(0,4) + " " +
						myValue.substr(9,2) + ":" +
						myValue.substr(11,2) + ":" +
						myValue.substr(13,2);
 				    document.getElementById("starttime").value = timestamp;
			    }
			    else if(myKey == 'Uptime') {
			        document.getElementById("uptime").value = myValue;
			    }
			    else if(myKey == 'GitBranch') {
			        console.log('GitBranch: ' + myValue);
			    }
			    else if(myKey == 'GitTag') {
			        console.log('GitTag: ' + myValue);
			    }
			    else if(myKey == 'GitRevision') {
			        console.log('GitRevision: ' + myValue);
			    }
			    else if(myKey == 'BuildTime') {
				    // Input format: 2023-04-02 10:56
				    var timestamp = myValue.substr(8,2) + "." +
						myValue.substr(5,2) + "." +
						myValue.substr(0,4) + " " +
						myValue.substr(11,2) + ":" +
						myValue.substr(14,2);
 				    document.getElementById("build-time").value = timestamp;
			    }
			    else if(myKey == 'FirmwareVersion') {
			        document.getElementById("firmware").value = myValue;
			    }
			    else if(myKey == 'HTMLVersion') {
			        document.getElementById("web-ui").value = myValue;
			    }
			    else if(myKey == 'Hostname') {
			        document.getElementById("hostname").value = myValue;
			    }
			    else if(myKey == 'IP') {
			        document.getElementById("IP-address").value = myValue;
			    }
			    else if(myKey == 'SSID') {
			        document.getElementById("wlan-ssid").value = myValue;
			    }
			    else if(myKey == 'SDCardPartitionSize') {
			        document.getElementById("SDCardPartitionSize").value = myValue + " MB";
			    }
			    else if(myKey == 'SDCardFreePartitionSpace') {
			        document.getElementById("SDCardFreePartitionSpace").value = myValue + " MB";
			    }
			    else if(myKey == 'SDCardPartitionAllocationSize') {
			        document.getElementById("SDCardPartitionAllocationSize").value = myValue + " byte";
			    }
			    else if(myKey == 'SDCardManufacturer') {
			        document.getElementById("SDCardManufacturer").value = myValue;
			    }
			    else if(myKey == 'SDCardName') {
			        document.getElementById("SDCardName").value = myValue;
			    }
			    else if(myKey == 'SDCardCapacity') {
			        document.getElementById("SDCardCapacity").value = myValue + " MB";
			    }
			    else if(myKey == 'SDCardSectorSize') {
			        document.getElementById("SDCardSectorSize").value = myValue + " byte";
			    }
			    else if(myKey == 'IDFVersion') {
			        console.log('IDFVersion: ' + myValue);
			    }
			    else if(myKey == 'ChipCores') {
			        document.getElementById("chip-cores").value = myValue;
			    }
			    else if(myKey == 'ChipRevision') {
			        document.getElementById("chip-revision").value = myValue;
			    }
			    else if(myKey == 'ChipFeatures') {
			        document.getElementById("chip-features").value = myValue;
			    }
			    else if(myKey == 'FreeHeapSize') {
			        document.getElementById("RAMTotalFree").value = myValue + " byte";
			    }
			    else if(myKey == 'FreeSPIHeapSize') {
			        document.getElementById("IntRAMFree").value = myValue + " byte";
			    }
			    else if(myKey == 'FreeInternalHeapSize') {
				    document.getElementById("IntRAMLargestFree").value = myValue + " byte";
			    }
			    else if(myKey == 'HeapLargestFreeBlockSize') {
				    document.getElementById("IntRAMMinFree").value = myValue + " byte";
			    }
			    else if(myKey == 'HeapIntLargestFreeBlockSize') {
				    document.getElementById("ExtRAMFree").value = myValue + " byte";
			    }
			    else if(myKey == 'MinFreeHeapSize') {
				    document.getElementById("ExtRAMLargestFree").value = myValue + " byte";
			    }
			    else if(myKey == 'MinFreeInternalHeapSize') {
				    document.getElementById("ExtRAMMinFree").value = myValue + " byte";
			    }
			}
		}
		
        function onError(event) {
            console.log('Error occurred');
			initWebSocket();
        }
</script>
</body>
</html>